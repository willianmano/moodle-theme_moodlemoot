{"version":3,"sources":["../src/sidebar.js"],"names":["define","$","CustomEvents","Log","PubSub","SELECTORS","TOGGLE_REGION","TOGGLE_ACTION","BODY","DRAWER","OVERLAY","small","document","width","Sidebar","length","debug","drawer","getElementById","on","preventPageScroll","registerEventListeners","closeAll","prototype","each","index","ele","trigger","find","overlay","attr","removeClass","toggleSidebar","e","target","body","addClass","open","focus","element","publish","delta","wheelDelta","originalEvent","detail","bottomOverflow","scrollTop","outerHeight","scrollHeight","topOverflow","preventDefault","events","activate","data","bind","SECTION","click","closest"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['jquery', 'core/custom_interaction_events', 'core/log', 'core/pubsub'],\n    function($, CustomEvents, Log, PubSub) {\n\n        var SELECTORS = {\n            TOGGLE_REGION: '[data-region=\"sidebar-toggle\"]',\n            TOGGLE_ACTION: '.sidebar-toggle',\n            BODY: 'body',\n            DRAWER: 'nav-sidebar',\n            OVERLAY: 'overlay-sidebar'\n        };\n\n        var small = $(document).width() < 768;\n\n        /**\n         * Constructor for the Sidebar.\n         *\n         */\n        var Sidebar = function() {\n\n            if (!$(SELECTORS.TOGGLE_REGION).length) {\n                Log.debug('Page is missing a drawer region');\n            }\n\n            if (!$(SELECTORS.TOGGLE_ACTION).length) {\n                Log.debug('Page is missing a drawer toggle link');\n            }\n\n            var drawer = $(document.getElementById(SELECTORS.DRAWER));\n            drawer.on('mousewheel DOMMouseScroll', this.preventPageScroll);\n\n            this.registerEventListeners();\n\n            if (small) {\n                this.closeAll();\n            }\n        };\n\n        Sidebar.prototype.closeAll = function() {\n            $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\n                var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n                var drawer = $(document.getElementById(SELECTORS.DRAWER));\n                var overlay = $(document.getElementById(SELECTORS.OVERLAY));\n\n                trigger.attr('aria-expanded', 'false');\n                drawer.attr('aria-hidden', 'true');\n                drawer.removeClass('active');\n                overlay.removeClass('active');\n            });\n        };\n\n        /**\n         * Open / close the blocks drawer.\n         *\n         * @method toggleSidebar\n         * @param {Event} e\n         */\n        Sidebar.prototype.toggleSidebar = function(e) {\n            var target = $(e.target);\n            var drawer = $(document.getElementById(SELECTORS.DRAWER));\n            var body = $(SELECTORS.BODY);\n            var overlay = $(document.getElementById(SELECTORS.OVERLAY));\n\n            body.addClass('drawer-ease');\n            var open = target.attr('aria-expanded') == 'true';\n            if (!open) {\n                // Open.\n                drawer.attr('aria-expanded', 'true');\n                drawer.attr('aria-hidden', 'false');\n                drawer.addClass('active');\n                drawer.focus();\n\n                overlay.attr('aria-expanded', 'true');\n                overlay.attr('aria-hidden', 'false');\n                overlay.addClass('active');\n\n                $(SELECTORS.TOGGLE_ACTION).each(function(index, element) {\n                    $(element).attr('aria-expanded', 'true');\n                });\n            } else {\n                // Close.\n                drawer.attr('aria-expanded', 'false');\n                drawer.attr('aria-hidden', 'true');\n                drawer.removeClass('active');\n\n                overlay.attr('aria-expanded', 'false');\n                overlay.attr('aria-hidden', 'true');\n                overlay.removeClass('active');\n\n                $(SELECTORS.TOGGLE_ACTION).each(function(index, element) {\n                    $(element).attr('aria-expanded', 'false');\n                });\n            }\n\n            // Publish an event to tell everything that the drawer has been toggled.\n            // The drawer transitions closed so another event will fire once teh transition\n            // has completed.\n            PubSub.publish('nav-drawer-toggle-start', open);\n        };\n\n        /**\n         * Prevent the page from scrolling when the drawer is at max scroll.\n         *\n         * @method preventPageScroll\n         * @param  {Event} e\n         */\n        Sidebar.prototype.preventPageScroll = function(e) {\n            var delta = e.wheelDelta || (e.originalEvent && e.originalEvent.wheelDelta) || -e.originalEvent.detail,\n                bottomOverflow = (this.scrollTop + $(this).outerHeight() - this.scrollHeight) >= 0,\n                topOverflow = this.scrollTop <= 0;\n\n            if ((delta < 0 && bottomOverflow) || (delta > 0 && topOverflow)) {\n                e.preventDefault();\n            }\n        };\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        Sidebar.prototype.registerEventListeners = function() {\n            $(SELECTORS.TOGGLE_ACTION).each(function(index, element) {\n                CustomEvents.define($(element), [CustomEvents.events.activate]);\n                $(element).on(CustomEvents.events.activate, function(e, data) {\n                    this.toggleSidebar(data.originalEvent);\n                    data.originalEvent.preventDefault();\n                }.bind(this));\n            }.bind(this));\n\n            $(SELECTORS.SECTION).click(function() {\n                if (small) {\n                    this.closeAll();\n                }\n            }.bind(this));\n\n            // Publish an event to tell everything that the drawer completed the transition\n            // to either an open or closed state.\n            $(SELECTORS.DRAWER).on('webkitTransitionEnd msTransitionEnd transitionend', function(e) {\n                var drawer = $(e.target).closest(SELECTORS.DRAWER);\n                var open = drawer.attr('aria-hidden') == 'false';\n                PubSub.publish('nav-drawer-toggle-end', open);\n            });\n        };\n\n        return {\n            'init': function() {\n                return new Sidebar();\n            }\n        };\n    });"],"file":"sidebar.min.js"}